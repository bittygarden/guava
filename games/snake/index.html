<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="è´ªåƒè›‡æ¸¸æˆ-åœ¨çº¿">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ‰</text></svg>">
    <title>è´ªåƒè›‡æ¸¸æˆ-åœ¨çº¿</title>
    <style>
        body {
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #212121;
        }

        #gameCanvas {
            width: 100%;
            height: 100%;
            border: #212121 0.2rem solid;
            box-sizing: border-box;
            background-color: #212121;
            transition: border-color 0.3s ease;
        }

        /* å®šä¹‰è¾¹æ¡†å‘å…‰é—ªçƒçš„åŠ¨ç”»ï¼Œæ·»åŠ æµè§ˆå™¨å‰ç¼€ */
        @-webkit-keyframes borderFlash {
            0% {
                border-color: #d2625dcc;
                -webkit-box-shadow: 0 0 5px #d2625dcc;
                box-shadow: 0 0 5px #d2625dcc;
            }

            50% {
                border-color: #ff8c87;
                -webkit-box-shadow: 0 0 20px #ff8c87;
                box-shadow: 0 0 20px #ff8c87;
            }

            100% {
                border-color: #d2625dcc;
                -webkit-box-shadow: 0 0 5px #d2625dcc;
                box-shadow: 0 0 5px #d2625dcc;
            }
        }

        @keyframes borderFlash {
            0% {
                border-color: #d2625dcc;
                -webkit-box-shadow: 0 0 5px #d2625dcc;
                box-shadow: 0 0 5px #d2625dcc;
            }

            50% {
                border-color: #ff8c87;
                -webkit-box-shadow: 0 0 20px #ff8c87;
                box-shadow: 0 0 20px #ff8c87;
            }

            100% {
                border-color: #d2625dcc;
                -webkit-box-shadow: 0 0 5px #d2625dcc;
                box-shadow: 0 0 5px #d2625dcc;
            }
        }

        #gameCanvas.flash {
            -webkit-animation: borderFlash 0.3s ease;
            animation: borderFlash 0.3s ease;
        }

        #modeSelector,
        #startButton {
            position: fixed;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            font-size: 24px;
            cursor: pointer;
            z-index: 1;
            box-sizing: border-box;
            width: 200px;
            text-align: center;
        }

        #modeSelector {
            bottom: 45vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            border: 2px solid hsl(330.23deg 67.54% 62.55%);
            border-radius: 10px;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        #modeSelector button {
            padding: 10px 15px;
            font-size: 24px;
            width: 100%;
            margin-bottom: 15px;
            text-align: center;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        /* ç®€å•æŒ‰é’®æ­£å¸¸çŠ¶æ€é¢œè‰² */
        #easyButton {
            background-color: #efa2c6;
            color: white;
        }

        /* ç®€å•æŒ‰é’®ç‚¹å‡»åé¢œè‰² */
        #easyButton.active {
            background-color: #61adea;
        }

        #easyButton:hover {
            background-color: #61adea;
        }

        /* ä¸­ç­‰æŒ‰é’®æ­£å¸¸çŠ¶æ€é¢œè‰² */
        #mediumButton {
            background-color: #efa2c6;
            color: white;
        }

        /* ä¸­ç­‰æŒ‰é’®ç‚¹å‡»åé¢œè‰² */
        #mediumButton.active {
            background-color: #61adea;
        }

        #mediumButton:hover {
            background-color: #61adea;
        }

        /* å›°éš¾æŒ‰é’®æ­£å¸¸çŠ¶æ€é¢œè‰² */
        #hardButton {
            background-color: #efa2c6;
            color: white;
        }

        /* å›°éš¾æŒ‰é’®ç‚¹å‡»åé¢œè‰² */
        #hardButton.active {
            background-color: #61adea;
        }

        #hardButton:hover {
            background-color: #61adea;
        }

        #startButton {
            bottom: 35vh;
            padding: 15px 20px;
            border: none;
            border-radius: 20px;
            background:linear-gradient(to right,#f64f59,#c471ed,#12c2e9);
            color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s ease;
        }

        #startButton:hover {
            background-color: #b1404c;
        }

        /* æ‰‹æœºç«¯æ–¹å‘é”®æ ·å¼ */
        #directionButtons {
            display: none;
            position: fixed;
            bottom: 40px;
            right: 40px;
            /* width: 100%; */
            text-align: center;
            z-index: 1;
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(2, 1fr);
            justify-items: center;
            align-items: center;
            gap: 20px;
        }

        #upButton {
            grid-column: 2 / 3;
            grid-row: 1 / 2;
        }

        #leftButton {
            grid-column: 1 / 2;
            grid-row: 2 / 3;
        }

        #rightButton {
            grid-column: 3 / 4;
            grid-row: 2 / 3;
        }

        #downButton {
            grid-column: 2 / 3;
            grid-row: 2 / 3;
        }

        #directionButtons button {
            width: 50px;
            height: 50px;
            font-size: 30px;
            /* background-color: rgba(220, 53, 69, 0.5); */
            background-color: transparent;
            border: 2px solid var(--green);
            color: white;
            box-shadow: inset 0 0 10px rgb(12 152 255), 0 0 9px 3px rgba(27, 253, 156, 0.1);
        }

        /* æŒ‰é’®ç‚¹å‡» */
        #directionButtons button:active {
            transform: scale(1.2);
        }

    </style>
</head>

<body>
    <canvas id="gameCanvas"></canvas>
    <div id="modeSelector">
        <button id="easyButton" data-mode="easy">ç®€å•</button>
        <button id="mediumButton" data-mode="medium">ä¸­ç­‰</button>
        <button id="hardButton" data-mode="hard">å›°éš¾</button>
    </div>
    <button id="startButton">å¼€å§‹æ¸¸æˆ</button>
    <div id="directionButtons">
        <button id="upButton">â†‘</button>
        <button id="leftButton">â†</button>
        <button id="rightButton">â†’</button>
        <button id="downButton">â†“</button>
    </div>
    <script>
        // è·å–ç”»å¸ƒå’Œç»˜å›¾ä¸Šä¸‹æ–‡
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const startButton = document.getElementById('startButton');
        const modeSelector = document.getElementById('modeSelector');
        const easyButton = document.getElementById('easyButton');
        const mediumButton = document.getElementById('mediumButton');
        const hardButton = document.getElementById('hardButton');
        const directionButtons = document.getElementById('directionButtons');
        const upButton = document.getElementById('upButton');
        const leftButton = document.getElementById('leftButton');
        const rightButton = document.getElementById('rightButton');
        const downButton = document.getElementById('downButton');

        // æ£€æµ‹æ˜¯å¦ä¸ºæ‰‹æœºè®¾å¤‡
        const isMobile = /Mobi|Android|iPhone/i.test(navigator.userAgent);

        // åŠ¨æ€è®¾ç½®ç”»å¸ƒå¤§å°
        function setCanvasSize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const minSize = Math.min(canvas.width, canvas.height);
            const blockCount = 20;
            return Math.floor(minSize / blockCount);
        }

        let blockSize = setCanvasSize();

        // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°è®¾ç½®ç”»å¸ƒå¤§å°
        window.addEventListener('resize', () => {
            blockSize = setCanvasSize();
            if (gameInterval) {
                // åªé‡æ–°è®¡ç®—ç”»å¸ƒå¤§å°å’Œæ–¹å—å°ºå¯¸ï¼Œä¸é‡æ–°å¼€å§‹æ¸¸æˆ
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
        });

        // å®šä¹‰è›‡çš„åˆå§‹ä½ç½®å’Œæ–¹å‘ï¼Œåˆå§‹é•¿åº¦ä¸º 2
        let snake;
        let direction;
        // å®šä¹‰é£Ÿç‰©çš„åˆå§‹ä½ç½®å’Œé¢œè‰²
        let food;
        // å®šä¹‰æ¸¸æˆå¾ªç¯çš„å®šæ—¶å™¨
        let gameInterval;
        // æ–°å¢å˜é‡ï¼Œç”¨äºæ ‡è®°æ˜¯å¦å¯ä»¥æ”¹å˜æ–¹å‘
        let canChangeDirection = true;

        // ä¸åŒæ¨¡å¼å¯¹åº”çš„æ¸¸æˆé€Ÿåº¦ï¼ˆæ¯«ç§’ï¼‰
        const modeSpeeds = {
            easy: 200,
            medium: 100,
            hard: 50
        };
        let currentSpeed = modeSpeeds.easy;
        let selectedMode = 'easy';

        // è·å–éè¾¹ç¼˜éšæœºä½ç½®çš„å‡½æ•°
        function getRandomNonEdgePosition(max) {
            // ç•™å‡ºè¾¹ç¼˜ç©ºé—´ï¼Œè¿™é‡Œè®¾ç½®è¾¹ç¼˜å®½åº¦ä¸º 1 ä¸ªæ–¹å—
            const edgeWidth = 1;
            return Math.floor(Math.random() * (max - 2 * edgeWidth)) + edgeWidth;
        }

        // ç”Ÿæˆéšæœºé¢œè‰²çš„å‡½æ•°
        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        // ç»˜åˆ¶å¸¦åœ†è§’çš„æ–¹å—
        function drawRoundedBlock(x, y, color, radius) {
            ctx.fillStyle = color;
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.arcTo(x + blockSize, y, x + blockSize, y + radius, radius);
            ctx.arcTo(x + blockSize, y + blockSize, x + blockSize - radius, y + blockSize, radius);
            ctx.arcTo(x, y + blockSize, x, y + blockSize - radius, radius);
            ctx.arcTo(x, y, x + radius, y, radius);
            ctx.closePath();
            ctx.fill();
        }

        // ç»˜åˆ¶è›‡ï¼ŒåŒºåˆ†å¤´éƒ¨å’Œå…¶ä½™æ–¹å—
        function drawSnake() {
            snake.forEach((segment, index) => {
                if (index === 0) {
                    // ç»˜åˆ¶å¤´éƒ¨ä¸ºåœ†å½¢
                    ctx.fillStyle = segment.color || 'green';
                    const centerX = segment.x * blockSize + blockSize / 2;
                    const centerY = segment.y * blockSize + blockSize / 2;
                    const radius = blockSize / 2;
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
                    ctx.fill();
                } else {
                    drawRoundedBlock(segment.x * blockSize, segment.y * blockSize, segment.color || 'green', 5);
                }
            });
        }

        // ç»˜åˆ¶é£Ÿç‰©
        function drawFood() {
            drawRoundedBlock(food.x * blockSize, food.y * blockSize, food.color, 5);
        }

        // ç§»åŠ¨è›‡
        function moveSnake() {
            // å…è®¸æ”¹å˜æ–¹å‘
            canChangeDirection = true;
            // å…ˆè®°å½•è›‡å¤´ç§»åŠ¨åçš„ä½ç½®
            let newHead = { ...snake[0] };
            switch (direction) {
                case 'right':
                    newHead.x++;
                    break;
                case 'left':
                    newHead.x--;
                    break;
                case 'up':
                    newHead.y--;
                    break;
                case 'down':
                    newHead.y++;
                    break;
            }

            // æ£€æŸ¥æ˜¯å¦æ’åˆ°è¾¹ç•Œ
            if (newHead.x < 0 || newHead.x >= canvas.width / blockSize || newHead.y < 0 || newHead.y >= canvas.height / blockSize) {
                clearInterval(gameInterval);
                startButton.style.display = 'block';
                modeSelector.style.display = 'block';
                directionButtons.style.display = 'none';
                return;
            }

            // æ£€æŸ¥æ˜¯å¦åƒåˆ°é£Ÿç‰©
            if (newHead.x === food.x && newHead.y === food.y) {
                // è®°å½•å½“å‰é£Ÿç‰©çš„é¢œè‰²
                const eatenFoodColor = food.color;

                // è§¦å‘è¾¹æ¡†å‘å…‰é—ªçƒæ•ˆæœ
                canvas.classList.add('flash');

                // ç›‘å¬åŠ¨ç”»ç»“æŸäº‹ä»¶ï¼ŒåŠ¨ç”»ç»“æŸåç§»é™¤ç±»
                const onAnimationEnd = () => {
                    canvas.classList.remove('flash');
                    canvas.removeEventListener('animationend', onAnimationEnd);
                };
                canvas.addEventListener('animationend', onAnimationEnd);

                // ç”Ÿæˆæ–°çš„é£Ÿç‰©
                food = {
                    x: getRandomNonEdgePosition(canvas.width / blockSize),
                    y: getRandomNonEdgePosition(canvas.height / blockSize),
                    color: getRandomColor()
                };

                // ä¸ºæ–°å¢åŠ çš„èº«ä½“éƒ¨åˆ†èµ‹äºˆè¢«åƒé£Ÿç‰©çš„é¢œè‰²
                const newSegment = {
                    x: snake[snake.length - 1].x,
                    y: snake[snake.length - 1].y,
                    color: eatenFoodColor
                };
                snake.push(newSegment);
            }

            // æ›´æ–°è›‡èº«ä½“æ¯ä¸ªéƒ¨ä½çš„ä½ç½®
            for (let i = snake.length - 1; i > 0; i--) {
                snake[i].x = snake[i - 1].x;
                snake[i].y = snake[i - 1].y;
            }

            // æ›´æ–°è›‡å¤´ä½ç½®
            snake[0] = newHead;
        }

        // æ£€æŸ¥ç¢°æ’
        function checkCollision() {
            let head = snake[0];
            // æ£€æŸ¥æ˜¯å¦æ’åˆ°è‡ªå·±
            for (let i = 1; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) {
                    clearInterval(gameInterval);
                    startButton.style.display = 'block';
                    modeSelector.style.display = 'block';
                    directionButtons.style.display = 'none';
                    return true;
                }
            }
            return false;
        }

        // æ¸¸æˆå¾ªç¯
        function gameLoop() {
            // æ¸…é™¤ç”»å¸ƒ
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // ç§»åŠ¨è›‡
            moveSnake();
            // ç»˜åˆ¶è›‡å’Œé£Ÿç‰©
            drawSnake();
            drawFood();
            // æ£€æŸ¥ç¢°æ’
            checkCollision();
        }

        // å¤„ç†é”®ç›˜äº‹ä»¶
        function handleKeyDown(event) {
            if (!canChangeDirection) return;
            switch (event.key) {
                case 'ArrowRight':
                    if (direction !== 'left') {
                        direction = 'right';
                        canChangeDirection = false;
                    }
                    break;
                case 'ArrowLeft':
                    if (direction !== 'right') {
                        direction = 'left';
                        canChangeDirection = false;
                    }
                    break;
                case 'ArrowUp':
                    if (direction !== 'down') {
                        direction = 'up';
                        canChangeDirection = false;
                    }
                    break;
                case 'ArrowDown':
                    if (direction !== 'up') {
                        direction = 'down';
                        canChangeDirection = false;
                    }
                    break;
            }
        }

        document.addEventListener('keydown', handleKeyDown);

        // å¤„ç†æ–¹å‘é”®ç‚¹å‡»äº‹ä»¶
        function handleDirectionButtonClick(newDirection) {
            if (!canChangeDirection) return;
            if (
                (newDirection === 'right' && direction !== 'left') ||
                (newDirection === 'left' && direction !== 'right') ||
                (newDirection === 'up' && direction !== 'down') ||
                (newDirection === 'down' && direction !== 'up')
            ) {
                direction = newDirection;
                canChangeDirection = false;
            }
        }

        upButton.addEventListener('click', () => handleDirectionButtonClick('up'));
        leftButton.addEventListener('click', () => handleDirectionButtonClick('left'));
        rightButton.addEventListener('click', () => handleDirectionButtonClick('right'));
        downButton.addEventListener('click', () => handleDirectionButtonClick('down'));

        // å¤„ç†æ¨¡å¼æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        function handleModeButtonClick(event) {
            // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„ active ç±»
            easyButton.classList.remove('active');
            mediumButton.classList.remove('active');
            hardButton.classList.remove('active');

            // ç»™å½“å‰ç‚¹å‡»çš„æŒ‰é’®æ·»åŠ  active ç±»
            event.target.classList.add('active');

            selectedMode = event.target.dataset.mode;
            currentSpeed = modeSpeeds[selectedMode];
        }

        easyButton.addEventListener('click', handleModeButtonClick);
        mediumButton.addEventListener('click', handleModeButtonClick);
        hardButton.addEventListener('click', handleModeButtonClick);

        // æ¨¡æ‹Ÿé»˜è®¤é€‰ä¸­ç®€å•æ¨¡å¼ï¼Œè®¾ç½®èƒŒæ™¯é¢œè‰²
        easyButton.classList.add('active');

        // åˆå§‹åŒ–æ¸¸æˆçŠ¶æ€
        function initGameState() {
            snake = [
                { x: 10, y: 10, color: getRandomColor() },
                { x: 9, y: 10, color: getRandomColor() }
            ];
            direction = 'right';
            food = {
                x: getRandomNonEdgePosition(canvas.width / blockSize),
                y: getRandomNonEdgePosition(canvas.height / blockSize),
                color: getRandomColor()
            };
        }

        // å¼€å§‹æ¸¸æˆçš„å‡½æ•°
        function startGame() {
            // åˆå§‹åŒ–æ¸¸æˆçŠ¶æ€
            initGameState();
            // éšè—å¼€å§‹æŒ‰é’®å’Œæ¨¡å¼é€‰æ‹©æ¡†
            startButton.style.display = 'none';
            modeSelector.style.display = 'none';
            // ä»…åœ¨æ‰‹æœºè®¾å¤‡ä¸Šæ˜¾ç¤ºæ–¹å‘æŒ‰é’®
            if (isMobile) {
                directionButtons.style.display = 'grid';
            }
            // å¯åŠ¨æ¸¸æˆå¾ªç¯
            gameInterval = setInterval(gameLoop, currentSpeed);
        }

        // ä¸ºå¼€å§‹æŒ‰é’®æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
        directionButtons.style.display = 'none';

        startButton.addEventListener('click', startGame);
    </script>
</body>

</html>